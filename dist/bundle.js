"use strict";$(function(){var o=function(o,e){return{API_BASE:"http://localhost:3000/api/",setAuthHeader:function(e){window.localStorage.setItem("sessionToken",e),o.ajaxSetup({headers:{Authorization:e}})}}}(jQuery);$('.nav-tabs a[data-toggle="tab"]').click(function(o){var e=window.localStorage.getItem("sessionToken");if($(this).hasClass("disabled")&&!e)return o.preventDefault(),!1}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).attr("href");"#log"===t&&o.log.setDefinitions(),"#update-log"===t&&o.log.setDefinitions(),"#history"===t&&o.log.setHistory()}),$(document).keypress(function(o){13===o.which&&($("#signup-modal").is(":visible")&&$("#signup").trigger("click"),$("#login-modal").is(":visible")&&$("#login").trigger("click"))});var e=window.localStorage.getItem("sessionToken");e&&o.setAuthHeader(e),window.WorkoutLog=o}),$(function(){$.extend(WorkoutLog,{definition:{userDefinitions:[],create:function(){var o={definition:{desc:$("#def-description").val(),type:$("#def-logtype").val()}};$.ajax({type:"POST",url:WorkoutLog.API_BASE+"definition",data:JSON.stringify(o),contentType:"application/json"}).done(function(o){WorkoutLog.definition.userDefinitions.push(o.definition),$("#def-description").val(""),$("#def-logtype").val(""),$("a[href='#log']").tab("show")})},fetchAll:function(){$.ajax({type:"GET",url:WorkoutLog.API_BASE+"definition",headers:{authorization:window.localStorage.getItem("sessionToken")}}).done(function(o){WorkoutLog.definition.userDefinitions=o}).fail(function(o){console.log(o)})}}}),$("#def-save").on("click",WorkoutLog.definition.create),window.localStorage.getItem("sessionToken")&&WorkoutLog.definition.fetchAll()}),$(function(){$.extend(WorkoutLog,{log:{meals:[],setHistory:function(){for(var o=WorkoutLog.log.meals,e=o.length,t="",i=0;i<e;i++)t+="<li class='list-group-item'>"+o[i].type+" - "+o[i].name+' <div class= "pull-right"><button id ="'+o[i].id+'" class = "update"><strong>U</strong></button><button id ="'+o[i].id+'" class = "remove"><strong>X</strong></button></div></li>';$("#history-list").children().remove(),$("#history-list").append(t)},create:function(){var o={log:{name:$("#mealName").val(),type:$("#mealType").val(),calories:$("#mealCals").val(),protein:$("#mealProtein").val(),fat:$("#mealFat").val(),carbs:$("#mealCarbs").val(),servings:$("#mealServings").val()}};$.ajax({type:"POST",url:WorkoutLog.API_BASE+"log",data:JSON.stringify(o),contentType:"application/json"}).done(function(o){WorkoutLog.log.meals.push(o),console.log("done done done"),$("#mealName").val(""),$("#mealType").val(""),$("#mealCals").val(""),$("#mealProtein").val(""),$("#mealFat").val(""),$("#mealCarbs").val(""),$("#mealServings").val(""),$('a[href="#history"]').tab("show")})},getWorkout:function(){var o={id:$(this).attr("id")};console.log(o);var e=o.id,t={log:o};$.ajax({type:"GET",url:WorkoutLog.API_BASE+"log/"+e,data:JSON.stringify(t),contentType:"application/json"}).done(function(o){$("a[href='#update-log']").tab("show"),$("#update-result").val(o.result),$("#update-description").val(o.description),$("#update-id").val(o.id)})},updateWorkout:function(){$("#update").text("Update");for(var o={id:$("#update-id").val(),desc:$("#update-description").val(),result:$("#update-result").val(),def:$("#update-definition option:selected").text()},e=0;e<WorkoutLog.log.workouts.length;e++)WorkoutLog.log.workouts[e].id==o.id&&WorkoutLog.log.workouts.splice(e,1);WorkoutLog.log.workouts.push(o);var t={log:o};$.ajax({type:"PUT",url:WorkoutLog.API_BASE+"log",data:JSON.stringify(t),contentType:"application/json"}).done(function(o){console.log(o),$("#update-description").val(""),$("#update-result").val(""),$("a[href='#history']").tab("show")})},delete:function(){var o={id:$(this).attr("id")},e={log:o},t=$.ajax({type:"DELETE",url:WorkoutLog.API_BASE+"log",data:JSON.stringify(e),contentType:"application/json"});$(this).closest("li").remove();for(var i=0;i<WorkoutLog.log.workouts.length;i++)WorkoutLog.log.workouts[i].id==o.id&&WorkoutLog.log.workouts.splice(i,1);t.fail(function(){console.log("nope, you didn't delete it")})},fetchAll:function(){$.ajax({type:"GET",url:WorkoutLog.API_BASE+"log",headers:{authorization:window.localStorage.getItem("sessionToken")}}).done(function(o){WorkoutLog.log.meals=o}).fail(function(o){console.log(o)})}}}),$("#newMealSave").on("click",WorkoutLog.log.create),$("#history-list").delegate(".remove","click",WorkoutLog.log.delete),$("#log-update").on("click",WorkoutLog.log.updateWorkout),$("#history-list").delegate(".update","click",WorkoutLog.log.getWorkout),window.localStorage.getItem("sessionToken")&&WorkoutLog.log.fetchAll()}),$(function(){$.extend(WorkoutLog,{signup:function(){var o=$("#su_age").val(),e=$("#su_height").val(),t=$("#su_startWeight").val(),i=$("#su_goalWeight").val(),a=$("#su_userGender").val(),n=$("#su_username").val(),l=$("#su_password").val(),s=$("#su_confirmPW").val(),r=$("#su_email").val(),u={user:{username:n,password:l,email:r,age:o,height:e,startweight:t,goalweight:i,gender:a}};s===l?$.ajax({type:"POST",url:WorkoutLog.API_BASE+"user",data:JSON.stringify(u),contentType:"application/json"}).done(function(o){o.sessionToken&&(WorkoutLog.setAuthHeader(o.sessionToken),WorkoutLog.log.fetchAll()),$("#signup-modal").modal("hide"),$(".disabled").removeClass("disabled"),$(".hidden").removeClass("hidden"),$("#loginout").text("Logout"),$("a[href='#profile']").tab("show"),console.log("worked")}).fail(function(){$("#su_error").text("There was an issue with sign up").show()}):($("#su_error").text("Passwords don't match").show(),$("#su_password").val(""),$("#su_confirmPW").val(""))},login:function(){var o={user:{username:$("#li_username").val(),password:$("#li_password").val()}},e=$.ajax({type:"POST",url:WorkoutLog.API_BASE+"login",data:JSON.stringify(o),contentType:"application/json"});e.done(function(o){o.sessionToken&&(WorkoutLog.setAuthHeader(o.sessionToken),WorkoutLog.log.fetchAll()),$("#login-modal").modal("hide"),$(".disabled").removeClass("disabled"),$(".hidden").removeClass("hidden"),$("#loginout").text("Logout"),$("#li_username").val(""),$("#li_password").val(""),$("a[href='#profile']").tab("show")}).fail(function(){$("#li_error").text("There was an issue with sign up").show()})},loginout:function(o){console.log("clicked"),window.localStorage.getItem("sessionToken")&&(window.localStorage.removeItem("sessionToken"),$("#loginout").text("Login"),window.location.reload())}}),$("#login").on("click",WorkoutLog.login),$("#signup").on("click",WorkoutLog.signup),$("#loginout").on("click",WorkoutLog.loginout),window.localStorage.getItem("sessionToken")&&($("#home").removeClass("active"),$("a[href='#profile']").tab("show"),$(".hidden").removeClass("hidden"),$(".disabled").removeClass(".disabled"))});